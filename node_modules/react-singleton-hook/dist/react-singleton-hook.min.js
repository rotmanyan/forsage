!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["exports","react","react-dom"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).ReactSingletonHook={},n.React,n.ReactDOM)}(this,(function(n,e,t){"use strict";function o(n){return n&&"object"==typeof n&&"default"in n?n:{default:n}}var r=o(e);function u(){return(u=Object.assign||function(n){for(var e=1;arguments.length>e;e++){var t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n}).apply(this,arguments)}var i=function(n){var t=n.useHookBody,o=n.applyStateChange,r=e.useRef(n.initValue);if("function"!=typeof t)throw Error("function expected as hook body parameter. got "+typeof t);var u=t();return e.useLayoutEffect((function(){r.current!==u&&(r.current=u,o(u))}),[o,u]),null},a=function(n){console&&console.warn&&console.warn(n)},f=!1,c=!1,l=!1,s=[],d=function(n){s.push(n)},p=function(){c=!0,e.useEffect((function(){return f&&a("SingletonHooksContainer is mounted second time. You should mount SingletonHooksContainer before any other component and never unmount it.Alternatively, dont use SingletonHooksContainer it at all, we will handle that for you."),f=!0,function(){return a("SingletonHooksContainer is removed from DOM. its not supported, singleton hooks will stop updating.")}}),[]);var n=e.useState([]),t=n[0],o=n[1];return e.useEffect((function(){d=function(n){return o((function(e){return[].concat(e,[n])}))},o(s)}),[]),r.default.createElement(r.default.Fragment,null,t.map((function(n,e){return r.default.createElement(i,u({},n,{key:e}))})))},m=function(n){var e;c||l||(l=!0,e=p,window&&window.document?t.render(r.default.createElement(e,null),window.document.createElement("div")):a("Can not mount SingletonHooksContainer on server side. Did you manage to run useEffect on server? Please mount SingletonHooksContainer into your components tree manually.")),d(n)},y=function(n,o){var r=!1,u=!1,i=void 0,a=[],f=function(n){i=n,t.unstable_batchedUpdates((function(){return a.forEach((function(e){return e(n)}))}))},c=function(){return u||(i="function"==typeof n?n():n,u=!0),i};return function(){var t=e.useState(c),u=t[0],l=t[1];return e.useEffect((function(){return r||(r=!0,m({initValue:n,useHookBody:o,applyStateChange:f})),a.push(l),i!==u&&l(i),function(){a.splice(a.indexOf(l),1)}}),[]),u}},g={singletonHook:y,SingletonHooksContainer:p};n.SingletonHooksContainer=p,n.default=g,n.singletonHook=y,Object.defineProperty(n,"__esModule",{value:!0})}));
